<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Echo Vault | Remembered Heroes</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    /* --- same CSS you had, with a few tweaks --- */
    body { font-family: 'Rajdhani', sans-serif; background: #000 url('https://i.imgur.com/8V7V3sP.jpg') no-repeat center/cover; color: var(--primary); }

    .stat-inputs {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(80px,1fr));
      gap: 0.8rem;
      margin-top: 1rem;
    }
    .stat-inputs label { font-size: 0.75rem; text-align: center; }
    .stat-inputs input { text-align: center; }

    .speech-bubble {
      margin: 1rem auto;
      max-width: 500px;
      background: rgba(26,27,38,0.8);
      border: 1px solid var(--accent);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      color: var(--light);
      font-style: italic;
      display: none;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn { from {opacity:0; transform:scale(0.95);} to {opacity:1; transform:scale(1);} }

    .mechanics-panel {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
    }
    .mechanics-panel.open {
      max-height: 600px;
      padding: 1.4rem;
    }
  </style>
</head>
<body>
  <header class="vault-header">
    <h1 class="vault-title">Echo Vault</h1>
    <p class="subtitle">"Speak the name. Recall the soul."</p>
  </header>

  <main>
    <!-- IDENTITY -->
    <div class="identity-grid">
      <div class="input-glyph"><label>Name</label><input type="text" id="char-name" placeholder="e.g. Kael" /></div>
      <div class="input-glyph"><label>Title</label><input type="text" id="char-title" placeholder="e.g. Oathbreaker" /></div>
      <div class="input-glyph"><label>Race</label>
        <select id="race" onchange="updateEcho()"><option value="human">Human</option><option value="elf">Elf</option><option value="dwarf">Dwarf</option><option value="tiefling">Tiefling</option></select>
      </div>
      <div class="input-glyph"><label>Class</label>
        <select id="class" onchange="updateEcho()"><option value="fighter">Fighter</option><option value="wizard">Wizard</option><option value="cleric">Cleric</option><option value="rogue">Rogue</option></select>
      </div>
    </div>

    <!-- ABILITY SCORES -->
    <div class="input-glyph">
      <label>Ability Scores</label>
      <div class="stat-inputs">
        <div><label>STR</label><input id="str" type="number" min="1" max="30" value="10" onchange="updateMechanics()" /></div>
        <div><label>DEX</label><input id="dex" type="number" min="1" max="30" value="10" onchange="updateMechanics()" /></div>
        <div><label>CON</label><input id="con" type="number" min="1" max="30" value="10" onchange="updateMechanics()" /></div>
        <div><label>INT</label><input id="int" type="number" min="1" max="30" value="10" onchange="updateMechanics()" /></div>
        <div><label>WIS</label><input id="wis" type="number" min="1" max="30" value="10" onchange="updateMechanics()" /></div>
        <div><label>CHA</label><input id="cha" type="number" min="1" max="30" value="10" onchange="updateMechanics()" /></div>
      </div>
    </div>

    <!-- 3D MODEL -->
    <div class="model-vault">
      <div class="model-scan"></div>
      <model-viewer id="echo-model"
        src="https://sbdev2.kavdev.io/demo_site/media/catalog/product/placeholder/d/a/da2ca97f07a7c70d87a9c88d3e552452e98c9d8d_1.glb"
        alt="Echo of the Hero"
        auto-rotate camera-controls shadow-intensity="1" exposure="1.2"></model-viewer>
    </div>

    <!-- VOICE -->
    <div class="voice-chamber">
      <button id="mic-btn" onclick="recordVoice()">üé§ Speak as Your Character</button>
      <div id="speech-output" class="speech-bubble"></div>
    </div>

    <!-- MECHANICS TOGGLE -->
    <div class="toggle-mechanics">
      <button class="btn-glyph" onclick="toggleMechanics()">üìä Reveal Mechanics</button>
    </div>

    <!-- MECHANICS PANEL -->
    <div class="mechanics-panel" id="mechanics-panel">
      <div class="stats-grid">
        <div class="stat"><div class="stat-value" id="ac">10</div><div class="stat-label">AC</div></div>
        <div class="stat"><div class="stat-value" id="hp">8</div><div class="stat-label">HP</div></div>
        <div class="stat"><div class="stat-value" id="init">+0</div><div class="stat-label">INIT</div></div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:0.8rem;margin:1rem 0;">
        <div>STR <span id="str-mod">+0</span></div><div>Save: <span id="str-save">+0</span></div>
        <div>DEX <span id="dex-mod">+0</span></div><div>Save: <span id="dex-save">+0</span></div>
        <div>CON <span id="con-mod">+0</span></div><div>Save: <span id="con-save">+0</span></div>
        <div>INT <span id="int-mod">+0</span></div><div>Save: <span id="int-save">+0</span></div>
        <div>WIS <span id="wis-mod">+0</span></div><div>Save: <span id="wis-save">+0</span></div>
        <div>CHA <span id="cha-mod">+0</span></div><div>Save: <span id="cha-save">+0</span></div>
      </div>
    </div>

    <!-- ACTION -->
    <div style="text-align:center;margin:2rem 0;">
      <button class="btn-glyph" onclick="saveEcho()">üíæ Etch to Vault</button>
    </div>

    <div class="echo-log" id="echo-log">No soul recalled.</div>
  </main>

  <script>
    function calcMod(score) { return Math.floor((score - 10) / 2); }

    function updateEcho() {
      const race = document.getElementById('race').value;
      const cls = document.getElementById('class').value;
      const model = document.getElementById('echo-model');
      const models = {
        tiefling: 'https://opengameart.org/sites/default/files/DemonCharacterGLB.glb',
        elf: 'https://opengameart.org/sites/default/files/ElvenArcherCharacterGLB.glb',
        dwarf: 'https://opengameart.org/sites/default/files/DwarfCharacterGLB.glb',
        human: 'https://sbdev2.kavdev.io/demo_site/media/catalog/product/placeholder/d/a/da2ca97f07a7c70d87a9c88d3e552452e98c9d8d_1.glb',
        wizard: 'https://opengameart.org/sites/default/files/WizardCharacterGLB.glb'
      };
      model.src = cls === 'wizard' ? models.wizard : models[race] || models.human;
      updateMechanics();
    }

    function updateMechanics() {
      const abilities = ['str','dex','con','int','wis','cha'];
      const cls = document.getElementById('class').value;
      abilities.forEach(stat => {
        const score = parseInt(document.getElementById(stat).value) || 10;
        const mod = calcMod(score);
        document.getElementById(`${stat}-mod`).textContent = mod>=0?`+${mod}`:`${mod}`;
        const profs = {fighter:['str','con'], wizard:['int','wis'], cleric:['wis','cha'], rogue:['dex','int']}[cls]||[];
        const save = mod + (profs.includes(stat)?2:0);
        document.getElementById(`${stat}-save`).textContent = save>=0?`+${save}`:`${save}`;
      });
      const dexMod = calcMod(parseInt(document.getElementById('dex').value));
      document.getElementById('ac').textContent = 10+dexMod;
      const conMod = calcMod(parseInt(document.getElementById('con').value));
      const classHP = {fighter:10, cleric:8, rogue:8, wizard:6}[cls];
      document.getElementById('hp').textContent = classHP+conMod;
      document.getElementById('init').textContent = dexMod>=0?`+${dexMod}`:`${dexMod}`;
    }

    function toggleMechanics() {
      const panel=document.getElementById('mechanics-panel');
      const btn=document.querySelector('.toggle-mechanics .btn-glyph');
      panel.classList.toggle('open');
      btn.textContent=panel.classList.contains('open')?'‚ùå Hide Mechanics':'üìä Reveal Mechanics';
    }

    function recordVoice() {
      const btn=document.getElementById('mic-btn');
      const output=document.getElementById('speech-output');
      if('SpeechRecognition'in window||'webkitSpeechRecognition'in window){
        const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
        const recog=new SR();
        recog.lang='en-US';
        btn.classList.add('listening'); btn.textContent='üîä Listening...';
        recog.start();
        recog.onresult=e=>{
          const transcript=e.results[0][0].transcript;
          output.textContent=transcript;
          output.style.display='block';
          btn.classList.remove('listening'); btn.textContent='‚úÖ Recorded';
          // Optional: TTS playback
          const utter=new SpeechSynthesisUtterance(transcript);
          speechSynthesis.speak(utter);
        };
        recog.onerror=()=>{btn.textContent='‚ùå Error'; btn.classList.remove('listening');};
        recog.onend=()=>{ if(btn.textContent.includes('Listening')){btn.textContent='üé§ Speak as Your Character'; btn.classList.remove('listening');}};
      } else { btn.textContent='‚ùå Voice not supported'; }
    }

    function saveEcho() {
      const data={name:document.getElementById('char-name').value||'Unknown', title:document.getElementById('char-title').value,
        race:document.getElementById('race').value, class:document.getElementById('class').value, savedAt:new Date().toISOString()};
      let vault=JSON.parse(localStorage.getItem('echo-vault'))||[];
      vault.push(data); localStorage.setItem('echo-vault',JSON.stringify(vault));
      alert(`üíæ ${data.name} has been archived in the Vault.`); updateLog();
    }

    function updateLog() {
      const vault=JSON.parse(localStorage.getItem('echo-vault'))||[];
      if(vault.length){
        const last=vault[vault.length-1]; const then=new Date(last.savedAt);
        const days=Math.floor((new Date()-then)/86400000);
        document.getElementById('echo-log').innerHTML=`Last echo: <strong>${last.name}</strong> (${last.class} ${last.race}) ‚Äî ${days} days ago.`;
      }
    }

    window.onload=()=>{updateEcho(); updateLog();};
  </script>
</body>
</html>
