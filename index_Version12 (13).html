// assumes character.glb has morphs "Smile", "BrowUp" and material slots for hair/eyes
import { Scene, WebGLRenderer, PerspectiveCamera, Color } from 'three';
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';

const scene = new Scene();
const camera = new PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 1.6, 3);
const renderer = new WebGLRenderer({ antialias:true }); document.body.appendChild(renderer.domElement);
renderer.setSize(innerWidth, innerHeight);

const loader = new GLTFLoader();
let faceMesh, hairMat, eyeMat;

loader.load('/assets/character.glb', gltf => {
  scene.add(gltf.scene);
  // find skinned face mesh that has morphTargetDictionary
  faceMesh = gltf.scene.getObjectByName('FaceMesh'); // adjust to your asset
  hairMat  = gltf.scene.getObjectByName('Hair')?.material;
  eyeMat   = gltf.scene.getObjectByName('Eyes')?.material;
  
  // example: set expression + colors
  setExpression({Smile:0.6, BrowUp:0.3});
  setHairColor('#4a3210');
  setEyeColor('#3db1ff');
  animate();
});

function setExpression(map){
  if (!faceMesh?.morphTargetDictionary) return;
  for (const [key,val] of Object.entries(map)){
    const idx = faceMesh.morphTargetDictionary[key];
    if (idx !== undefined) faceMesh.morphTargetInfluences[idx] = val;
  }
}
function setHairColor(hex){ if (hairMat) hairMat.color = new Color(hex); }
function setEyeColor(hex){ if (eyeMat) eyeMat.color = new Color(hex); }

function animate(){ requestAnimationFrame(animate); renderer.render(scene, camera); }
addEventListener('resize', ()=>renderer.setSize(innerWidth, innerHeight));
